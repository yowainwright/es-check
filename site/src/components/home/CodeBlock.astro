---
import { AnimatedTerminal } from './AnimatedTerminal';
import { getUrl } from "../../utils/url";
import { codeToHtml } from 'shiki';
import '../../styles/terminal.css';

const extractInnerHTML = (html: string) => {
  const match = html.match(/<code[^>]*>(.*?)<\/code>/s);
  return match ? match[1] : html;
};

const cmd1Html = await codeToHtml("npx es-check es5 './dist/**/*.js'", {
  lang: 'bash',
  theme: 'github-dark',
});
const cmd1 = extractInnerHTML(cmd1Html);

const cmd2Html = await codeToHtml("npx es-check es6 './src/**/*.js' --module", {
  lang: 'bash',
  theme: 'github-dark',
});
const cmd2 = extractInnerHTML(cmd2Html);

const cmd3Html = await codeToHtml("npx es-check es5 './build/**/*.js'", {
  lang: 'bash',
  theme: 'github-dark',
});
const cmd3 = extractInnerHTML(cmd3Html);

const demos = [
  {
    lines: [
      { prefix: '$', text: cmd1, animate: true },
      { prefix: '', text: 'info: ES-Check: checking 24 files...', className: 'text-cyan-400', delay: 200, animate: false },
      { prefix: '', text: 'info: ✓ ES-Check passed! All files are ES5 compatible.', className: 'text-success', delay: 300, animate: false },
      { prefix: '', text: '', delay: 150, animate: false },
      { prefix: '$', text: cmd2, animate: true, delay: 150 },
      { prefix: '', text: 'info: ES-Check: checking 18 files...', className: 'text-cyan-400', delay: 200, animate: false },
      { prefix: '', text: 'info: ✓ ES-Check passed! All files are ES6 compatible.', className: 'text-success', delay: 300, animate: false },
      { prefix: '', text: '', delay: 150, animate: false },
      { prefix: '$', text: cmd3, animate: true, delay: 150 },
      { prefix: '', text: 'info: ES-Check: checking 3 files...', className: 'text-cyan-400', delay: 200, animate: false },
      { prefix: '', text: 'error: ES-Check: there were 2 ES version matching errors.', className: 'text-red-400', delay: 300, animate: false },
      { prefix: '', text: '  ./build/app.js - Unexpected token', className: 'text-red-400', delay: 50, animate: false },
      { prefix: '', text: '  ./build/utils.js - Unexpected token', className: 'text-red-400', delay: 50, animate: false },
    ],
    pauseAfter: 3000,
  },
];
---

<div class="py-20 lg:py-28 pb-28 lg:pb-36">
  <div class="xl:flex gap-16 items-center max-w-2xl md:max-w-6xl mx-auto px-4">
    <div class="xl:max-w-xl flex flex-col justify-center font-outfit">
      <h2 class="text-4xl lg:text-5xl font-black">
        Simple <span class="text-primary">ES Version </span>Checking for
        Production
      </h2>

      <p class="mt-8 text-lg">
        ES Check ensures your JavaScript code is compatible with your target
        ECMAScript version so you can run your code where you want: catch
        compatibility issues before they reach production, integrate seamlessly
        with your CI/CD pipeline, and maintain confidence in your browser support!
      </p>

      <div class="flex gap-4 mt-8">
        <a href={getUrl('docs/gettingstarted')} class="btn btn-lg btn-primary text-lg border border-base-content/10"> Get Started </a>

        <a href="https://github.com/yowainwright/es-check" class="btn btn-lg btn-ghost text-lg border border-base-content/10"> View on GitHub </a>
      </div>
    </div>

    <div class="flex-1 overflow-hidden mt-7 xl:mt-0">
      <AnimatedTerminal client:only="react" demos={demos} loop={false} typingSpeed={15} height="380px" />
    </div>
  </div>
</div>
